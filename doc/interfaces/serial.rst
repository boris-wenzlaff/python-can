.. _serial:

CAN over Serial
===============
A text based interface. For example use over bluetooth with
``/dev/rfcomm0`` or with Arduino ``/dev/ttyACM0``

[arduino-serial-hex-sniffer](https://github.com/boris-wenzlaff/arduino-serial-hex-sniffer)
[arduino-python-can-serial-demo](https://github.com/boris-wenzlaff/arduino-python-can-serial-demo)

Bus
---

.. autoclass:: can.interfaces.serial.serial_can.SerialBus

Internals
---------
The frame that will be send and receive over the serial interface consists of
six parts. The start and the stop byte for the frame, the timestamp, DLC,
arbitration ID and the payload. Only the payload has a variable length of bytes
(0 - 8 bytes), the other parts are fix. Both, the timestamp and the arbitration
ID will be interpreted as 4 byte unsigned integers. The DLC is a also a unsigned
integer with a length of 1 byte.

Serial frame format
^^^^^^^^^^^^^^^^^^^
+-------------------+----------------+-----------------------------------------------+-------------------------------+-------------------------+---------+--------------+
|                   | Start of frame | Timestamp                                     | DLC                           | Arbitration ID          | Payload | End of frame |
+===================+================+==============================+================+===============================+=========================+=========+==============+
| **Length (Byte)** | 1              | 4                                             | 1                             | 4                       | 0 - 8   | 1            |
+-------------------+----------------+-----------------------------------------------+-------------------------------+-------------------------+---------+--------------+
| **Data type**     | Byte           | Unsigned 4 byte integer                       | Unsigned 1 byte integer       | Unsigned 4 byte integer | Byte    | Byte         |
+-------------------+----------------+-----------------------------------------------+-------------------------------+-------------------------+---------+--------------+
| **Byte order**    | \-             | Little-Endian                                 | Little-Endian                 | Little-Endian           | \-      | \-           |
+-------------------+----------------+-----------------------------------------------+-------------------------------+-------------------------+---------+--------------+
| **Description**   | Must be 0xAA   | Usually s, ms or Âµs since start of the device | Length in byte of the payload | \-                      | \-      | Must be 0xBB |
+-------------------+----------------+-----------------------------------------------+-------------------------------+-------------------------+---------+--------------+

Examples of serial frames
^^^^^^^^^^^^^^^^^^^^^^^^^

CAN message with 8 byte payload
"""""""""""""""""""""""""""""""

+----------------+-----------------------------------------+
| CAN message                                              |
+----------------+-----------------------------------------+
| Arbitration ID | Payload                                 |
+================+=========================================+
| 1              | 0x11 0x22 0x33 0x44 0x55 0x66 0x77 0x88 |
+----------------+-----------------------------------------+

+----------------+---------------------+------+---------------------+-----------------------------------------+--------------+
| Serial frame                                                                                                               |
+----------------+---------------------+------+---------------------+-----------------------------------------+--------------+
| Start of frame | Timestamp           | DLC  | Arbitration ID      | Payload                                 | End of frame |
+================+=====================+======+=====================+=========================================+==============+
| 0xAA           | 0x66 0x73 0x00 0x00 | 0x08 | 0x01 0x00 0x00 0x00 | 0x11 0x22 0x33 0x44 0x55 0x66 0x77 0x88 | 0xBB         |
+----------------+---------------------+------+---------------------+-----------------------------------------+--------------+

CAN message with 1 byte payload
"""""""""""""""""""""""""""""""

+----------------+---------+
| CAN message              |
+----------------+---------+
| Arbitration ID | Payload |
+================+=========+
| 1              | 0x11    |
+----------------+---------+

+----------------+---------------------+------+---------------------+---------+--------------+
| Serial frame                                                                               |
+----------------+---------------------+------+---------------------+---------+--------------+
| Start of frame | Timestamp           | DLC  | Arbitration ID      | Payload | End of frame |
+================+=====================+======+=====================+=========+==============+
| 0xAA           | 0x66 0x73 0x00 0x00 | 0x01 | 0x01 0x00 0x00 0x00 | 0x11    | 0xBB         |
+----------------+---------------------+------+---------------------+---------+--------------+

CAN message with 0 byte payload
"""""""""""""""""""""""""""""""

+----------------+---------+
| CAN message              |
+----------------+---------+
| Arbitration ID | Payload |
+================+=========+
| 1              | None    |
+----------------+---------+

+----------------+---------------------+------+---------------------+--------------+
| Serial frame                                                                     |
+----------------+---------------------+------+---------------------+--------------+
| Start of frame | Timestamp           | DLC  | Arbitration ID      | End of frame |
+================+=====================+======+=====================+==============+
| 0xAA           | 0x66 0x73 0x00 0x00 | 0x00 | 0x01 0x00 0x00 0x00 | 0xBBS        |
+----------------+---------------------+------+---------------------+--------------+